 Настройка
====================

  Процесс скачивания
====================

*Сложность: высокая (для не понимающих, что происходит и просто желающих скачать видосики гуманитариев)*

Общий процесс:

    1. Скачай FFMpeg (https://ffmpeg.zeranoe.com/builds/) для своей платформы. Достань из папки bin в архиве ffmpeg и положи в доступное место.

    2. Открой страницу с видео в Chrome. Прямо чтобы плеер видно было.

    3. Нажми Shift + Ctrl + I.

Дальше две ситуации. Пробуй по очереди:

    4. В открывшейся консоли вбей следующее: $x("//html//video")[0].firstChild.src. Полученную ссылку надо вставить вместо переменной {m3u8_link} в команде ниже.
    
    5. Открой терминал в той папке, где лежит ffmpeg и выполни команду: 
    ./ffmpeg.exe -timeout 5000000 -reconnect 1 -reconnect_at_eof 1 -reconnect_streamed 1 -reconnect_delay_max 2 -i "{m3u8_link}" -bsf:a aac_adtstoasc -c copy ./{название_урока}.mp4
    
    --- ИЛИ ---
    
    4. В открывшейся консоли вбей следубщее: $x("//html//iframe")[0].src. Получится ссылка, по которой тебе надо перейти. ПКМ - Открыть в новой вкладке. Там тоже открываешь консоль (см. п. 3), а страницу с видео, на которой находился до этого, закрываешь (не забудь переменную).
    
    5. В новой полученной консоли вбей две команды:
    
        1) JSON.parse(localStorage[`account_${localStorage.account_id}`]).access_token :: результат выполнения - это переменная {auth_tkn}. Без кавычек.
        
        2) $x("//html//video")[0].firstChild.src :: результат выполнения - переменная {m3u8_link}. Без кавычек.
        
        3) location.href :: результат выполнения - это переменная {referer_url}. Без кавычек.
    
    6. Открой терминал в той папке, где лежит ffmpeg и выполни команду c заменой переменных:
    ./ffmpeg.exe -timeout 5000000 -reconnect 1 -reconnect_at_eof 1 -reconnect_streamed 1 -reconnect_delay_max 2 -headers "Authorization: {auth_tkn}" -headers "Referer: {referer_url}" -headers "Origin: https://lesson.foxford.ru" -user_agent "Mozilla/5.0 (iPhone; CPU iPhone OS 10_3 like Mac OS X) AppleWebKit/602.1.50 (KHTML, like Gecko) CriOS/56.0.2924.75 Mobile/14E5239e Safari/602.1" -i "{m3u8_link}" -bsf:a aac_adtstoasc -c copy ./{название_урока}.mp4

--------------------

Чейнджлог (Крупные апдейты)
====================

---

18.06.2017 (v1)
---

Реализована первая версия методом "проб и ошибок".

С помощью расширения (https://chrome.google.com/webstore/detail/network-sniffer/coblekblkacfilmgdghecpekhadldjfj) необходимо перехватить момент перехода к видео. Нажав на поле со ссылкой, соответствующей видео, откроется поле, где в Request Headers будет параметр Cookie. 

В скрипт вводится 2 значения: адрес видео и куки. На выходе получается файл b64.html, в котором находится ссылка, при переходе по которой происходило перенаправление на плеер, выдающий mp4, который качался с помощью расширения (https://chrome.google.com/webstore/detail/video-downloader-pro/ilppkoakomgpcblpemgbloapenijdcho).

(Отдельное спасибо *Paravozik_Lesha* за тестирование пре-релизной версии и терпение моего характера c: )

---

21.06.2017 (v2)
---

Реализована полу-автоматическая система.

Вбивается ссылка на видео и человека перенаправляет сразу в плеер, где с помощью нажатия "Сохранить как..." можно сохранить вебинар на диск (логично). 

Примерно тогда же была реализована система сохранения ДЗ в оффлайн.

---

30.07.2017 (v3)
---

Реализована полная автоматика и какой-никакой интерфейс.

Все скрипты были объединены в один.

Перевод на русский язык (да-да, наканецта).

Загрузка курсов была переписана *Stanley Kowalski*. Пришлось много чинить, конечно, но это не отменяет моего "спасиба" за факт реализации "другим способом" и то, что именно он подтолкнул меня на объединение обоих скриптов.

---

05.08.2017 (v4)
---

Исправлено множество ошибок.

Разделение на модули для легкости починки.

Добавлено сохранение теории и ДЗ.

Объединение всех действий в единый оператор. За один проход теперь можно скачать весь материал полностью.

Сделан режим "только видео" и сортировка материала. (Отдельное спасибо *@kuzminovdmit*)

Добавлено возобновление загрузки на случай, если что-то пойдет не так, чтобы не ждать по-новой. Необходимо просто выбрать после перезапуска пункт меню, который выбирался до этого.

Создание файла "video.skips", содержащего число, приведет к пропуску видео на соответствующее число. (0 - Вводное занятие, 1 - Первое + Вводное ...)

--------

25.12.2017 (v5)
---

Внесены исправления в соответствии с изменениями на сайте, призванными привести скрипт в негодность. Я умываю руки.

*Current version*: v5-rstable1

--------

Original idea + Releases: limitedeternity

Testing + Ideas: Stanley Kowalski / Paravozik_Lesha

VideoDownloader(): Stanley Kowalski (v3)

(Специально для 2ch.hk/un/)
